apiVersion: v1
kind: Service
metadata:
  name: gatepoint
  namespace: gatepoint
  labels:
    app: gatepoint
    service: gatepoint
spec:
  ports:
    - name: http
      port: 8081
      targetPort: 8081
  type: NodePort
  selector:
    app: gatepoint
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: gatepoint
  namespace: gatepoint
spec:
  replicas: 1
  selector:
    matchLabels:
      app: gatepoint
  template:
    metadata:
      labels:
        app: gatepoint
    spec:
      containers:
        - image: release.daocloud.io/skoala/gatepoint:0.11
          imagePullPolicy: IfNotPresent
          name: gatepoint
          ports:
            - containerPort: 8081
          volumeMounts:
            - mountPath: /config/
              name: gatepoint-config
      volumes:
        - name: gatepoint-config
          configMap:
            name: gatepoint-config
            items:
              - key: config.yaml
                path: config.yaml
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: gatepoint-config
  namespace: gatepoint
data:
  config.yaml: |
    server:
      http:
        addr: 0.0.0.0:8081
        timeout: 1s
      grpc:
        addr: 0.0.0.0:9091
        timeout: 1s
    
    kubernetes:
      kubeconfig: |
        apiVersion: v1
        clusters:
          - cluster:
              certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUMvakNDQWVhZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRJek1EZ3dNakF6TkRBd00xb1hEVE16TURjek1EQXpOREF3TTFvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTWtDCmdSVnAwUkQ1QVUzRldWaTBHUXQwSlp6em1Qc0VLT3h0cUQyd3pIVGFObnM5ci93elRiakc4aUtuV3BJcElMOWQKNmVOb0xXb0Zvb3ROS05oWDFJdlJzL05QVktya0tldFpxVTlnVGdTR3hiOHpkZFNzbS9RTTFRRExhQ0VGV0JPcAo4cG85bEk2bDRRTnpvKzd6dGwybStKa3pReDdNSlNmQ09zTGVaaUwxSHlXRk9qUWxHWWlPd200TDJWV3dJeXhlCmlIVk9sYkRKRDBoamJUcWszUjhFQTQ1UjV2TzdCMm9lck1aZnM1Z2FCVyt3U2phN0JSb21QZGRZaTY1MXdXQ24KUkxNUXp4YUtjMGhaL1U1OWVsdyt3cHp1YnVYeHp6Qk9MMG9XSmtYMHVTS3Q4QzN4K2hsMUlGSEJoSkc3UHd5dQo3Z2g1VTcrdHBUV2hxTDhNN1lzQ0F3RUFBYU5aTUZjd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZFRXNEU05WRnp2K3Nuc2ZqRFptdVJjMHhFNmZNQlVHQTFVZEVRUU8KTUF5Q0NtdDFZbVZ5Ym1WMFpYTXdEUVlKS29aSWh2Y05BUUVMQlFBRGdnRUJBSm8zeGMraG8va0taajNyWEQxRQpyTlZZdFVLVy9Od2lXWVJ1eHp0Qm5Cbi9kU3JiWVlGOFRtVVpwVjQvdmlqZXEwNWlWSjV0T292ME1aYVpLc2wrCi9SK0hGeXMrSklVNGdGWFBqVlpmY0hBWWlmRitXMzZycWRrUlJaYk5MeGh3QTA3Y2l5TVJaeTFia3JNbDhscCsKbm92b3l0RXpWTWN2bkhHdlhKOExLQkxTVDZTT2Z0UjU5Q0RuM2NTS3dzckZCVlFVbVpMbkF3bmsvZlg2L2F6cAo1d1hIbWRoeUVOZ3NXc3EwTkRicVJIdGZWcEtyS0NONVZzTkhHcWxwcHFPa2p3VTdzOUFlSGRWc2VRbnc0WDZRCm5RSy9FdVJwUlhBa1RDYTNLeS80VkNBVFp3dWk5Zkt4VzJYdStMNStORnZNUThndkZRWmZPdzlMa0tjRmdUQUoKUUljPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
              server: https://172.30.120.220:6443
            name: cluster.local
        contexts:
          - context:
              cluster: cluster.local
              user: kubernetes-admin
            name: kubernetes-admin@cluster.local
        kind: Config
        preferences: {}
        users:
          - name: kubernetes-admin
            user:
              client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURJVENDQWdtZ0F3SUJBZ0lJTHp3d2JqbXoyTjR3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB5TXpBNE1ESXdNelF3TUROYUZ3MHlOREE0TURFd016UXdNRFJhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXR4bFkxZm9oMmxodW5KWGUKd1JFOERScmRJeFgvdlp4c1JvbXhpcWVjRlVRNkVmVExVQUtCa3ZuNld5Z1FRam1FVjZzQm1ad1AxUFZ2UktEagpua0pNMEp2bGxQQmxOdkNldW1iSEhjeVZ5TkRWM3NoTHl1bGxwK2lhR1ArSDlRUWhVeHRoWElMdVJnZEVHZGk3CmhYSWVDczlINWhwWi9Jam5Ed2dGVGxQU0pzSVlRVzdzN2hGNitKKzNEK3BVVWxaajh6RERTTlpzYzQ5Q0FnRm8KaXFXUjBKVHJIM21GdmdGUS9CSGpHeEFwanAxSzIzYWVXMlV5Tk9Vb2NsMlc2Q1FMbitsTHZpRW9OVzdhcmRoVwpuZmtJelFET2h4SEJ2alQrWXM1MS9OUFY2b2N4LzFjbnhBOUFCbzNXeDJTVEJDeGlxL0VVSjZtMDZIem13eEFhCmZPd2tIUUlEQVFBQm8xWXdWREFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RBWURWUjBUQVFIL0JBSXdBREFmQmdOVkhTTUVHREFXZ0JSQkxBMGpWUmM3L3JKN0g0dzJacmtYTk1STwpuekFOQmdrcWhraUc5dzBCQVFzRkFBT0NBUUVBdFlpQkhRT0NIWlBaV1ZnVUNmN2RxSUpxb05QaW5LNUxaeWtSCk44U29KK1MxYnkyc2U4d01pV1dvUGkyQUJGd3o5MXJWck5yUmJPZVIxS1gyYXVlU0hFTVZjOUFOanpyYTU5alcKNDhXaURyM1hxaHhOeU9CY3BLTUtIZjJYbU93SjZIUjFNa0ZHMXp1TGRmenNlOFA4THFlUWxtbjhpT0lQblJRYwpTc2VvVkZPVmpTUkhaTU12Z0ZiTDFuOVFlaDhBNXNMWWI0ZmhOeFFvRU55TUx6QUhQeVA4eVZxWGxTWUhpUUhrCjV3WkJzenMvSU9tVkVnVzJkcUVER2hmeWZXaTlwc3A0ZmtrTmZydVc1QjRrWFkxcVhiN1JKMFhqWW5FRUFrc0sKLzcyVUptRmJBUldXWEFxaWlmdkY2VXRHdjlnRno0QlZkMFZVL3YxRUs0V0d5T3VBa2c9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
              client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBdHhsWTFmb2gybGh1bkpYZXdSRThEUnJkSXhYL3ZaeHNSb214aXFlY0ZVUTZFZlRMClVBS0Jrdm42V3lnUVFqbUVWNnNCbVp3UDFQVnZSS0RqbmtKTTBKdmxsUEJsTnZDZXVtYkhIY3lWeU5EVjNzaEwKeXVsbHAraWFHUCtIOVFRaFV4dGhYSUx1UmdkRUdkaTdoWEllQ3M5SDVocFovSWpuRHdnRlRsUFNKc0lZUVc3cwo3aEY2K0orM0QrcFVVbFpqOHpERFNOWnNjNDlDQWdGb2lxV1IwSlRySDNtRnZnRlEvQkhqR3hBcGpwMUsyM2FlClcyVXlOT1VvY2wyVzZDUUxuK2xMdmlFb05XN2FyZGhXbmZrSXpRRE9oeEhCdmpUK1lzNTEvTlBWNm9jeC8xY24KeEE5QUJvM1d4MlNUQkN4aXEvRVVKNm0wNkh6bXd4QWFmT3drSFFJREFRQUJBb0lCQUVHdUdQemc5a1hSMVJQYwpld1I4dnpMZ1FSVTE3Z0JCWFdITVFPREJFUzlid3d6djZBS3ljM0thczJFQnRSdGNjSW5XTVFPK1JMdWFzeWhHCklvQ0J2ZlpUQmY3d1lRNWRNRU1qWFNmbVhKQ2x3U0ppYlRYRGxaQ3UwcUJIQWFrMXF4S1p6c29WdVkxclM5V04KdG02L0tlR3N5MWpTZVJjcXNOL21lNmpHVHF0Ujl4Yi9rRlZKbjdBamZlamZkRTdzcWwxSGpZOStnaXI1R3VuNgpydmFQZUlVR0V2TmZ0YXFQa1RTK0ZsQUNxcUw3L015ZDBCY1JiNFBJR3FvdWdHVFYwMzQyR3pybnVKK08xWmtEClQrNzNDa0xDUGlPWjFncEM2cmFLcTc2K0xteThFTng0YmdUTDJ6RkVYbkZ5RWlFQU9DbGtOcnhqWE5VbWhFTVQKa2FNbTJ5RUNnWUVBNkNRSXF4UWFvTHVvblFxYW5yUHdZeGxkVnpaKzkreldFU1BYS3NNMFRPbmZNeWtBWVVBSgpLZFFSZjl3WWd0bFM1dituUTI3RlBhdFNvcXliWHhwRi83WEVxZk1Fakk5akJNcTdCdVF6amtEN285RlFuM1l4ClVJYWJkU09CR3VoZkdMSytna3QvNmpudzB5MlpWRmQ0d01rTVFELzdpZG1WcDZzcmlIaW1CelVDZ1lFQXllcnoKMFFGMTlGSXFQN1NFd3NlcmMveFFTdzNvcTJ6MHZGRXgwaTJEOFpTbXdieVQ1Y0ZKRFozOFNDRlRtRHFnQkNKQwpEcEdkc2R2ankraUc0QWdVZCtwdU9wMmpVTXFoT2VMNVVvZzVobXNzRUtjNmFlRGI3dFVkN2Rwc2Zqdy9HZ3R6CjB1WTFCS2toSU1QRVk1eGY1dEliOEJkYWI5U1RYRTJpVlQ3b2Zra0NnWUJtQnhCWVFLbkRZemNrYm5pdXI5OUQKYnU1N1dsUkxteWdxdUZubFRZNDdENzh0dVNPVm1wTnNjdXlPQ2Fvc09HQWJidG1RNWFxREJEMTVpZXR2elJoZQozd0Rrd1E2S3lLcDRmTEhld1lWM1RGQk5HNzRYbDliczBYeVo2MVRmQXFwcExJWld0ZUF1amZDdW9DZjN6Y29nCjBUdzFNT25aR0d5U0dNVTFZZkYyMFFLQmdRQ2tvUFl1QU56bFdXQ3RGRWZ5YjgzeEFWV04vRWNxRGVuMDZOYVEKSVNBbEJpaDRhWUxFbnpVcTd4YlUwS2RSeE9yV3MvL2IxUW9ZQzhyTlpFY2p2akxDR3RmSTN1SmJhdnJOTWF4SwppRnN1cDQ4RC9QVDVncWFQTWgvMjRGSDVFckg0VUVJZFFDa1dKYmVtK1RiVWFKa2duMHE4Rks1ZDQ1cEtkZG5YCld6VkFVUUtCZ1FDa0hIQzh0RDlTWlNQU2N1eXJaWGFEWXRYOFd4QTB0cmFjU3Npc2s2WHlFRmYzVENlcS9xUEkKRWEzbEpOT3FxanpBa3N0TTBEb2pCWkkxZUM2K0UxdkxyRnB0amFBN25rYjB1QmVmVDRuZEsza0g5TFhyOXdSdApveDkzM0pXMkhMRy9NRDhPMWNhOG9kMEYwS1BjMDBiUis4bnJzbnozZ2xUdTdDNXNnOVFUaVE9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
